box: wercker-labs/docker
# Build definition
build:
  # The steps that will be executed on build
  steps:
    - install-packages:
        packages: "node npm python"

    - mktemp:
        envvar: TMPDIR
        directory: true

    - script:
        name: "install fig"
        code: |
          curl -L https://github.com/docker/fig/releases/download/1.0.1/fig-`uname -s`-`uname -m` > $TMPDIR/fig
          sudo install -v -m 755 $TMDIR/fig /usr/local/bin/fig

    # A custom script step, name value is used in the UI
    # and the code value contains the command that get executed

    - script:
        name: echo dependency versions
        code: |
          echo "python version $(python --version) running"
          echo "pip version $(pip --version) running"
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"
          echo "docker version $(docker -v) running"
          echo "fig version $(fig --version) running"

    # A step that executes `npm install` command
    - npm-install

    # A step that executes `npm test` command
    - npm-test

    - script:
        name: run sauce tests
        code: make saucetest