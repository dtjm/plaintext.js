box: tvaughan/ubuntu14.04@1.1.0
build:
  steps:
    - install-packages:
        packages: "python"

    - script: "install docker"
        name: "install docker"
        code: curl -sSL https://get.docker.com/ubuntu/ | sudo sh

    - script:
        name: "install nodejs"
        code: |
          curl -sL https://deb.nodesource.com/setup | sudo bash -
          sudo apt-get install -y nodejs

    - script:
        name: "install fig"
        code: |
          if [ -f $WERCKER_CACHE_DIR/fig ]; then
            debug "found fig in cache"
          else
            debug "fig not in cache, downloading"
            curl -L https://github.com/docker/fig/releases/download/1.0.1/fig-`uname -s`-`uname -m` > $WERCKER_CACHE_DIR/fig
          fi
          sudo install -v -m 755 $WERCKER_CACHE_DIR/fig /usr/local/bin/fig

    - script:
        name: echo dependency versions
        code: |
          python --version
          node -v
          npm -v
          docker -v
          fig --version

    - npm-install

    - script:
        name: make
        code: make

    - npm-test

    - script:
        name: run sauce tests
        code: make saucetest